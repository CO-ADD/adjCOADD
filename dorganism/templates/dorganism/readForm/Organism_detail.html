<!--prettier-ignore-->
{% extends 'base.html'%}
<!--prettier-ignore-->
{% block title%} mysite{% endblock %}
<!--prettier-ignore-->
{% block content%}
<div class="mx-2 border border-2">
    <div>
        <a class="btn btn-sm btn-outline-secondary" href="{%url 'org_card' %}"><i class="bi bi-view-list"></i><i
                class="bi bi-arrow-bar-left"></i></a>
    </div>

    <div class="m-atuo">
        <div class="d-flex justify-content-between my-2">

            <div id="{{object.pk}}">
                <a class="btn btn-sm">Update Organism Name</a>
            </div>
            {%include 'dorganism/deleteForm/Organism_del.html'%}
        </div>

        <div id="OrganismUpdateModal" class="modal fade " role="dialog" data-bs-backdrop="static">
        </div>

        <script>
            $(document).ready(function () {
                btn = "#" + "{{object.pk}}"
                let my_modal = $('#OrganismUpdateModal');
                $(`${btn} a`).click(function () {
                    my_modal.load("{% url 'organism_update' object.pk %}", function (response) {
                        if (response == "Permission Not Granted") {
                            alert("permission!")

                        } else {
                            my_modal.modal("show"); // Open Modal
                        }
                    });
                });
                if (document.formHasErrors) {
                    my_modal.modal('show');
                }
            });

        </script>

        <script>
            $(document).ready(function () {
                let my_modal = $('#OrganismUpdateModal');
                if (document.formHasErrors) {
                    my_modal.modal('show');
                }
            })
        </script>

    </div>
    <div class="accordion" id="organism-detail">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingOne">
                <button class="accordion-button" style="max-height:20px;" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseOne" aria-expanded="true" aria-controls="collapseOne">
                    <h5 class="fs-6 my-0">Organism: {{object.organism_name}} | Class:
                        {{object.organism_name.org_class.dict_value}}

                    </h5>


                </button>
            </h2>
            <div id="collapseOne" class="accordion-collapse collapse show" aria-labelledby="headingOne"
                data-bs-parent="#accordionExample">
                <div class="accordion-body">

                    <!-- <p>{{Organism_Name}}</p> -->

                    {% if messages %}
                    <ul class="messages">
                        {% for message in messages %}
                        <li{% if message.tags %} class="{{ message.tags }}" {% endif %}>{{ message }}</li>
                            {% endfor %}
                    </ul>
                    {% endif %}
                    <!-- ===================================================================================== -->

                    <b>
                        {%include 'utils/message.html'%}
                    </b>
                    {%include '../updateForm/Organism_u_withoutname.html'%}


                </div>

            </div>

        </div>
    </div>

    <!-- <div class="accordion" id="organism-batch-detail">
        <div class="accordion-item">
            <h2 class="accordion-header" id="headingTwo">
                <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse"
                    data-bs-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
                    Organism Batch
                </button>
            </h2>
            <div id="collapseTwo" class="accordion-collapse collapse" aria-labelledby="headingTwo"
                data-bs-parent="#accordionExample">
                <div class="accordion-body"> -->
    <h5>{%include 'utils/message.html'%}</h5>

    <div class="table-responsive">
        <a id="createBatch" class="card-link text-success" style="float: right">Add New
            <i class="bi bi-plus"></i>
        </a>
        <table class="table table-editable table-nowrap align-middle table-edits">
            <thead>
                <tr>
                    {%for th in batch_fields %}
                    <th>{{th}}</th>
                    {%endfor%}
                    <th>EDIT</th>
                    <th>update</th>

                </tr>
            </thead>
            <tbody>
                {% for object in batch_obj %}

                <tr data-id="{{object.pk}}">
                    <!-- ORGANISM_BATCH_modelFIELDs = ["orgbatch_id","organism_id","batch_no","batch_notes","qc_status","qc_record","supplier","supplier_code","supplier_po","stock_date","biologist"] -->
                    <td data-field="{{object.pk}}" style="width: 80px">{{object.pk}}</td>
                    <td data-field="{{object.organism_id}}">{{object.organism_id}}</td>
                    <td data-field="{{object.batch_no}}">{{object.batch_no}}</td>
                    <td data-field="{{object.batch_notes}}">{{object.batch_notes}}</td>
                    <td style="width: 100px">
                        <a class="btn btn-outline-secondary btn-sm edit" title="Edit">
                            <i class="fas fa-pencil-alt"></i>
                        </a>
                    </td>
                    <td data-field="update">update</td>

                </tr>
                {%endfor%}
            </tbody>
        </table>
    </div>
    <!-- </div>
            </div>


        </div> -->


    <!-- </div> -->
    {% load static %}
    <script type="text/javascript" src="{% static 'js/jquery-3.6.1.min.js' %}"></script>
    <script src="{% static 'js/editableTable.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/editableTablechoices.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/table-edits.min.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/table-editable.int.js' %}" type="text/javascript"></script>
    <script src="{% static 'js/js_utils/getCookie.js'%}"></script>


    <div id="createBatchModal" class="modal fade" role="dialog"></div>

    <script>
        $(document).ready(function () {
            let my_modal = $("#createBatchModal");

            $("#createBatch").click(function () {
                my_modal.load("{%url 'batch_create'%}", function (response) {
                    if (response == "Permission Not Granted") {
                        alert("permission!");
                    } else {
                        my_modal.modal("show"); // Open Modal
                    }
                });
            });
        });
    </script>
    <script>
        $(document).ready(function () {
            console.log("ready...")
            var slect = $('a[title="Edit"]')
            console.log(slect)
        });
        $('td[data-field="update"]').on('click', function () {

            // var title1 = $(this).children('i')[0].title
            var tr_parent = $(this).parent()
            var td_child = tr_parent.children('td')
            // console.log(typeof ($(this).parent()))
            // if (title1 === 'Edit') {
            for (let i = 0; i < td_child.length - 2; i++) {
                a = td_child[i].innerText

                console.log(a)
            }
            // sendToServer()
            // }
            // var id = rowset['data-id']


        })


        // const csrftoken = getCookie('csrftoken');

        // const sendToServer = (id, value, type) => {
        //     $.ajax({
        //         url: '{%url 'batch_update' object.pk %}',
        //         type: "POST",
        //         headers: { 'X-CSRFToken': csrftoken },
        //         data: { id: id, value: value, type: type }

        //     })
        //         .done((response) => {
        //             console.log(response)
        //             // window.location.reload()
        //         })
        //         .fail(() => {
        //             console.log("Error occured")
        //         })
        // }
    </script>

    {%endblock%}