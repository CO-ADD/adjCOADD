<div class="leftbar d-flex flex-column p-0 mb-3 h-25">
  <div class="d-flex flex-column p-0">
    <a class="btn-sm" id="hidefilter" data-bs-toggle="tooltip" data-bs-placement="right" title="C/O FilterSwitcher">
      <i class="bi bi-funnel fs-6" style='color: yellow'></i>
    </a>
  </div>
  <div class="d-flex flex-column p-0" style="background-color: var(--bs-th-bg)">

    <a href="{%url list_url %}" class="btn-sm btn-outline-success" data-bs-toggle="tooltip" data-bs-placement="right"
      title="Table View"><i class="fa-solid fa-table-list fs-6" style='color: white'></i></a>

    <a href="{%url card_url %}" class="btn-sm btn-outline-success" data-bs-toggle="tooltip" data-bs-placement="right"
      title="Card View"><i class="fa-solid fa-grip fs-6 " style='color: white'></i></a>

  </div>
  <!-- Create New Entry Modal-->
  <div class="d-flex flex-column p-0" style="background-color: var(--bs-th-bg)">
    <!-- prettier-ignore -->
    {% include 'utils/miscellaneous/create_a.html' with create_object=create_object create_objectModal=create_objectModal model_name=model_name %}
  </div>
  <div class="d-flex flex-column" style="background-color: var(--bs-th-bg)">
    <div class="pt-2">
      <a class="btn-sm btn-outline-success" href="{{import_module}}" data-bs-toggle="tooltip" data-bs-placement="right"
        title="Import Data via Files"><i class="fa fa-file-import fs-6" style='color: red'></i>
      </a>
    </div>

    <div class="btn-group p-0 mt-2" data-bs-toggle="tooltip" data-bs-placement="right"
      title="Click to Export DATA with selecting Fields ">
      <a class="btn-sm btn-outline-success" data-bs-toggle="dropdown" aria-expanded="false" href="javascript:void(0)">
        <i class="fa fa-file-export fs-6 " style='color: green'></i>
      </a>
      <ul class="dropdown-menu">
        <!--  -->

        {% for field in model_fields %}
        <li>
          <input
            class="filled-in"
            type="checkbox"
            value="{{field}}"
            name="model_field_select"
          />
          <label for=""> {{field}} </label>
        </li>
        {% endfor %}
        <button class="data_export bg-dark text-light" style="float: right">
          <i class="fa-solid fa-download" style='color: green'></i>
        </button>
      </ul>
    </div>
  </div>
</div>


{% load static %}
<script src="{%static 'js/js_utils/saveData.js'%}"></script>

<script>
  $(document).ready(function () {
    const csrftoken = getCookie("csrftoken");

    $(".data_export").on("click", function () {
      // select wanted data to export
      var selected_data = [];

      $("input:checkbox[name=type]:checked").each(function () {
        selected_data.push($(this).val().toString());
      });

      // select wanted model fields
      var selected_fields = [];
      $("input:checkbox[name=model_field_select]:checked").each(function () {
        selected_fields.push($(this).val().toString());
      });
      console.log(selected_fields);
      // export model
      var model_name = $(".checkbox-container-export").data("type");
      console.log(selected_data);
      $.ajax({
        url: "/exportData/",
        type: "POST",
        headers: { "X-CSRFToken": csrftoken },
        data: {
          data_arr: selected_data,
          fields: selected_fields,
          model_name: model_name,
        },
      })
        .done((response) => {
          saveData(response, "mycsv.csv");
        })
        .fail(() => {
          console.log("Error occured");
        });
    });
  });
</script>
