<!-- Step line container -->
<div class="m-2" style="height: fit-content;">
  <h1 class="m-5 text-center">{{data_model}} Data Import</h1>
  <form method="post" enctype="multipart/form-data" class="row m-5 text-center">
    {% csrf_token %}
    <!--  -->
    {{ wizard.management_form }}
    <!-- Left column (Prcoess Action Area) -->
    <div class="col-md-5 border border-2" style="position: relative;">
      <h4 class="bg-light px-5" style="position: absolute; left: 30%; top: -15px">
        Process
      </h4>
      <!-- Process step Line -->
      <div class="step-line">
        <div class="step {% if wizard.steps.current == 'upload_file' %}active{% endif %}">
          Upload File
        </div>
        <div class="step {% if wizard.steps.current == 'step1' %}active{% endif %}">
          {{step1}}
        </div>

        <!-- add more steps here for example:    <div class="step {% if wizard.steps.current == 'step2' %}active{% endif %}">{{step2}}</div> -->

        <div class="step {% if wizard.steps.current == 'finalize' %}active{% endif %}">
          Finalize
        </div>
      </div>
      <!-- Process steps Area -->
      <!-- Steps Forms -->
      <div class="row border bg-light" style="height: 20em">
        {% if wizard.steps.current == 'upload_file' %}

        <div class="p-3 m-auto">
          {% for field in wizard.form %}
          <p class="p-auto m-auto">
            <!--prettier-ignore-->
            {{ field.label_tag }}
            <strong>{{ field.help_text }}</strong>{{field }}
          </p>
          {% endfor %}
        </div>
        <!-- This is step 1-->
        {% elif wizard.steps.current == 'step1' %}
        <div class="p-3 m-auto">
          {% for field in wizard.form %}
          <p class="p-auto m-auto">
            <!--prettier-ignore-->
            {{ field.label_tag }}
            <strong>{{ field.help_text }}</strong>{{field }}
          </p>
          {% endfor %}
        </div>

        <!-- add more steps here: ...-->

        <!-- This is the final-->
        {% elif wizard.steps.current == 'finalize' %}
        <div class="p-3 m-auto">
          {% for field in wizard.form %}
          <p class="p-auto m-auto">
            <!--prettier-ignore-->
            {{ field.label_tag }}
            <strong>{{ field.help_text }}</strong>{{field }}
          </p>

          <!--prettier-ignore-->
          {% endfor %}
        </div>
        {% endif %}
      </div>

      <!-- Button Actions -->
      <div class="row m-5 border">
        {% if wizard.steps.prev %}
        <button class="btn btn-sm m-auto col-md-3" type="button" id="cancel-button" onclick="window.location.reload(true);">
          <i class="fa-solid fa-ban"></i>
        </button>
        <button class="btn btn-sm m-auto col-md-3" name="wizard_goto_step" type="submit"
          value="{{ wizard.steps.prev }}">
          <i class="fa-solid fa-left-long"></i>
        </button>
        {%else%}
        <button class="btn btn-sm m-auto col-md-3" type="button" id="cancel-button" onclick="window.location.reload(true);">
          <i class="fa-solid fa-ban"></i>
        </button>
        <button class="btn btn-sm m-auto col-md-3" disabled>
          <i class="fa-solid fa-left-long"></i>
        </button>
        {% endif %}

        <!--prettier-ignore-->
        {% if wizard.steps.prev and wizard.steps.next %}
        <button class="btn btn-sm m-auto col-md-3 nextstep" type="submit" value="Next">
          <i class="fa-solid fa-right-long"></i>
        </button>
        {%elif wizard.steps.next%}

        <button class="btn btn-sm m-auto col-md-3 nextstep" type="submit" value="Click to start">
          <i class="fa-solid fa-play"></i>
        </button>
        {%else%}
        <button class="btn btn-sm m-auto col-md-3" type="submit" value="Finalize">
          <i class="fa-solid fa-check"></i>
        </button>

        {%endif%}
      </div>
    </div>
    <!-- Right column (Process Message)-->
    <!--  -->
    <div class="col-md-7 border border-2" style="position: relative">
      <h4 class="bg-light px-4" style="position: absolute; left: 30%; top: -15px">
        Message
      </h4>
      <div class="progress_message">
        <div class="progress mt-3" style="height: 20px">
          <span id="progress-bar" class="progress-bar" role="progressbar" style="width: 0%" aria-valuenow="0"
            aria-valuemin="0" aria-valuemax="100">
            0%
          </span>
        </div>
        <div class="mt-5">
          <h3 class="selectfiles not-visible text-start text-info ms-2">Selected Files</h3>
          <ul class="text-start mb-5" id="multi-files-list"></ul>
          
          <!--prettier-ignore-->
          {% for field in wizard.form %}
          {% for error in field.errors %}
          <p class="text-danger show-error">{{ error }}</p>
          {% endfor %}
          <!--  -->
          {% endfor %}
          <div>{{progress}}</div>
         
          <div class="validation_result overflow-auto p-0 m-2" style="max-height: 500px">
            {{validation_result | safe}}
          </div>
        </div>
      </div>
    </div>
  </form>
</div>

<!-- Display the selected files in upload form on the message -->
<script>
  const $fileNamesContainer_files = $("#multi-files-list");

  if ("{{ form.multi_files.auto_id }}") {
    $("#{{ form.multi_files.auto_id }}").on("change", function () {
      if ($(".selectfiles").hasClass("not-visible")) {

        $(".selectfiles").removeClass("not-visible")
      }
      $fileNamesContainer_files.empty();
      const files = this.files;
      for (let i = 0; i < files.length; i++) {
        let select_li = files[i].name;

        const fileInfo = $("<li data-name='" + select_li + "'></li>").text(
          files[i].webkitRelativePath || files[i].name
        );
        $fileNamesContainer_files.append(fileInfo);
      }
    });
    $("#id_upload_file-multi_files").click(() => {
      $(".show-error").text("");
    });
  }
</script>
<script>
  $('button[name="wizard_goto_step"').click(()=>{
    $("#id_step1-confirm").removeAttr('required')
  })
</script>
