<!-- Step line container -->
<div class="m-2 vh-100">
  <h1 class="m-5 text-center">{{data_model}} Data Import</h1>
  <form
    method="post"
    enctype="multipart/form-data"
    class="row m-5 text-center border vh-100"
  >
    {% csrf_token %}
    <!--  -->
    {{ wizard.management_form }}
    <!-- Left column (Prcoess Action Area) -->
    <div class="col-md-5 border border-2" style="position: relative">
      <h4
        class="bg-light px-5"
        style="position: absolute; left: 30%; top: -15px"
      >
        Process
      </h4>

      <!-- Button Actions -->
      <div class="row m-5 border">
        {%if wizard.steps.prev %}
        <a
          type="button"
          class="btn btn-sm m-auto col-md-3"
          href="{%url 'import-vitek'%}"
          onclick="window.location.reload(true);"
          >Cancel
        </a>
        {%else%}
        <button type="button" class="btn btn-sm m-auto col-md-3" disabled>
          Cancel
        </button>
        {%endif%}
        <!--  -->
        {%if wizard.steps.prev%}
        <!--  -->
        <button
          class="btn btn-sm col-md-3"
          name="wizard_goto_step"
          type="submit"
          value="{{ wizard.steps.prev }}"
        >
          Pre
        </button>
        {%else%}
        <button type="button" class="btn btn-sm m-auto col-md-3" disabled>
          Prev
        </button>
        {%endif%}
        <!--prettier-ignore-->
        {%if wizard.steps.prev and wizard.steps.next %}
         {%if Confirm_to_Save%}
        <input
          class="btn btn-sm m-auto col-md-3"
          type="submit"
          value="Save to DB"
        />
        <!--prettier-ignore-->
        {%else%}
        <button class="btn btn-sm m-auto col-md-3" disabled>
          Error Contains
        </button>
        <!--prettier-ignore-->
        {%endif%}
        <!--  -->
        {%elif wizard.steps.next%}
        <input class="btn btn-sm m-auto col-md-3" type="submit" value="Next" />
        {%elif wizard.steps.prev%}
        <input
          class="btn btn-sm m-auto col-md-3"
          type="submit"
          value="Finalize"
        />
        {%endif%}
      </div>
      <!-- Process steps Area -->
      <div class="row">
        <!-- Process step Line -->
        <div class="col-md-2 step-line border">
          <div
            class="step {% if wizard.steps.current == 'upload_file' %}active{% endif %}"
          >
            Upload File
          </div>
          <div
            class="step {% if wizard.steps.current == 'step1' %}active{% endif %}"
          >
            {{step1}}
          </div>

          <!-- add more steps here for example:    <div class="step {% if wizard.steps.current == 'step2' %}active{% endif %}">{{step2}}</div> -->

          <div
            class="step {% if wizard.steps.current == 'finalize' %}active{% endif %}"
          >
            Finalize
          </div>
        </div>
        <!-- Steps Forms -->
        <div class="col-md-8 border bg-light ms-0" style="height: 20em">
          {% if wizard.steps.current == 'upload_file' %}
          <div class="p-3">
            {% for field in wizard.form %}
            <p class="p-auto">
              <!--prettier-ignore-->
              {{ field.label_tag }}
              <strong>{{ field.help_text }}</strong>{{field }}
            </p>
            {% endfor %}
          </div>
          <!-- This is step 1-->
          {% elif wizard.steps.current == 'step1' %}
          <div class="p-3">
            {% for field in wizard.form %}
            <p class="p-auto">
              <!--prettier-ignore-->
              {{ field.label_tag }}
              <strong>{{ field.help_text }}</strong>{{field }}
            </p>
            {% endfor %}
          </div>

          <!-- add more steps here: ...-->

          <!-- This is the final-->
          {% elif wizard.steps.current == 'finalize' %}
          <div class="p-3">
            {% for field in wizard.form %}
            <p class="p-auto">
              <!--prettier-ignore-->
              {{ field.label_tag }}
              <strong>{{ field.help_text }}</strong>{{field }}
            </p>

            <!--prettier-ignore-->
            {% endfor %}
          </div>
          {% endif %}
        </div>
      </div>
    </div>
    <!-- Right column (Process Message)-->
    <!--  -->
    <div class="col-md-7 border border-2" style="position: relative">
      <h4
        class="bg-light px-4"
        style="position: absolute; left: 30%; top: -15px"
      >
        Message
      </h4>
      <div class="progress_message">
        <div class="mt-5">
          <ul class="text-start" id="multi-files-list"></ul>
          <p class="progressfilename text-info text-start"></p>
          <!--prettier-ignore-->
          {% for field in wizard.form %}
          {% for error in field.errors %}
          <p class="text-danger show-error">{{ error }}</p>
          {% endfor %}
          <!--  -->
          {% endfor %}
          <div>
            <!--prettier-ignore-->
            {% if wizard.steps.current == 'step1' and Confirm_to_Save == False%}
            <span class="text-danger"
              >Files contains errors, please recheck or select a Organism
              Batch</span
            >
            {% endif %}
          </div>
          <div
            class="validation_result overflow-auto"
            style="max-height: 500px"
          >
            <!--prettier-ignore-->
            {%if validation_result%} 
            {% for table in validation_result %}
            {{table | safe}} 
            {% endfor %} 
            {%endif%}
          </div>
        </div>
      </div>
    </div>
  </form>

  <script>
    const $fileNamesContainer_files = $("#multi-files-list");

    if ("{{ form.multi_files.auto_id }}") {
      $("#{{ form.multi_files.auto_id }}").on("change", function () {
        $fileNamesContainer_files.empty();
        const files = this.files;
        for (let i = 0; i < files.length; i++) {
          const fileInfo = $("<li></li>").text(
            files[i].webkitRelativePath || files[i].name
          );
          $fileNamesContainer_files.append(fileInfo);
        }
      });
      $("#id_upload_file-multi_files").click(() => {
        $(".show-error").text("");
      });
    }
  </script>
</div>
