<table id="datatable_batch" class="cell-border" style="width: 100%">
  <thead>
    <tr>
      <th>Stock</th>
      {%for th in batch_fields %}
      <th>{{th}}</th>
      {%endfor%}
      <th style="width: 10em">EDIT</th>
    </tr>
  </thead>
  <tbody hx-target="closest tr" hx-swap="outerHTML">
    {% for object_batch in batch_obj %}
    <!--  -->
    {%include 'dorganism/readForm/Batch_tr.html'%}
    <!--  -->
    {%endfor%}
  </tbody>
</table>

{%load static%}
<script src="{% static 'js/js_utils/getCookie.js'%}"></script>
<script>
  $(document).ready(function () {
    var table = $("#datatable_batch").DataTable({
      searching: false,
      paging: false,
    });
    console.log("{{object_batch}}");
    const csrftoken = getCookie("csrftoken");
    $("#datatable_batch tbody").on("click", "td.dt-control", function (e) {
      var tr = $(this).closest("tr");
      var row = table.row(tr);

      if (row.child.isShown()) {
        // This row is already open - close it
        destroyChild(row);
        tr.removeClass("shown");
      } else {
        // Open this row
        // getStockData(row.data()[1]);
        createChild(row);
        tr.addClass("shown");
      }
    });
  });
  function createChild(row) {
    // This is the table we'll convert into a DataTable
    var table = $('<table class="display" width="100%"/>');
    // Display it the child row
    row.child(table).show();
    // Initialise as a DataTable
    var Batch_id = row.data()[1];
    console.log(Batch_id);
    var usersTable = table.DataTable({
      dom: "Bfrtip",
      pageLength: 5,
      ajax: {
        url: `/stocklist/${Batch_id}`,
        type: "GET",
        headers: { "X-CSRFToken": csrftoken },
        data: { Batch_id },
      },
      columns: [
        { title: "Orgbatch ID", data: "orgbatch_id" },
        { title: "Stock ID", data: "stock_id" },
        { title: "Stock Note", data: "stock_note" },
        { title: "Stock Type", data: "stock_type" },
        { title: "Stock Date", data: "stock_date" },
        // { title: "Biologist", data: "biologist" },
      ],
      select: true,
    });
  }
  function destroyChild(row) {
    var table = $("table", row.child());
    table.detach();
    table.DataTable().destroy();

    // And then hide the row
    row.child.hide();
  }

  const csrftoken = getCookie("csrftoken");
  // function getStockData(Batch_id) {
  //   console.log(Batch_id);
  //   $.ajax({
  //     url: `/stocklist/${Batch_id}`,
  //     type: "GET",
  //     headers: { "X-CSRFToken": csrftoken },
  //     data: { Batch_id },
  //     success: (res) => {
  //       table_data_stock = res.data[0];
  //     },
  //     error: (err) => {
  //       console.log(err);
  //     },
  //   });
  // }
</script>
